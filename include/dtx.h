#ifndef DTX_H
#define DTX_H

#include "common.h"
#include "arch.h"

typedef enum {
	DTX_RUNNING = 1,
	DTX_COMMIT,
	DTX_ABORT,
} dtx_status;

/*
 * 48 bytes
 */
struct dtx_struct {
	__le32	t_status; /* transaction status */
	__le32	t_num; /* how many logs */
	__le32	t_checksum; /* transaction checksum */
	__le32	t_id; /* transaction id */
	__le32	t_size; /* how many bytes in this transaction, excluding the header */
	__le64	t_start; /* first log address */
	__le32	t_next; /* next transaction address offset */
	__le64	t_version; /* version number generated by the stm */
	char	padding[16];
} __packed;

extern struct dtx_struct* dtx_begin(uint64_t timestamp);
extern void dtx_commit(struct dtx_struct* dtx);
extern void dtx_abort();

#endif
